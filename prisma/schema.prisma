generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Provider {
  GOOGLE
  PASSWORD
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String?
  provider      Provider
  name          String?
  image         String?

  // ðŸ”¹ CHAT RELATIONS
  chats         Chat[]    @relation("ChatUsers")
  messages      Message[]

  // ðŸ”¹ AUTH / SECURITY
  resetTokens   PasswordResetToken[]

  isOnline      Boolean  @default(false)
  lastSeen      DateTime?
  is2FAEnabled  Boolean  @default(false)
  twoFASecret   String?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

model Chat {
  id        String   @id @default(uuid())

  // ðŸ”¹ exactly 2 users per chat (logical rule, DB level flexible)
  users     User[]   @relation("ChatUsers")

  messages  Message[]

  createdAt DateTime @default(now())
}

model Message {
  id        String   @id @default(uuid())

  chatId   String
  senderId String
  content  String
  read     Boolean  @default(false)

  chat     Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender   User     @relation(fields: [senderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}
